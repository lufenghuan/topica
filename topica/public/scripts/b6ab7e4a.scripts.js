(function(){var a;a=angular.module("topicaApp",["ngRoute","ngSanitize","ngCookies","restangular","http-auth-interceptor","ui.bootstrap","ngAnimate","monospaced.elastic","angularMoment","ui-gravatar","md5","topicaApp.directives.pluspicker","topicaApp.directives.ngFocus","topicaApp.directives.newscard","topicaApp.filters.linebreak"]),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupController"}).when("/profile/:profileId",{templateUrl:"views/profile_topics.html",controller:"ProfileTopicsController"}).when("/profile/:profileId/topics",{templateUrl:"views/profile_topics.html",controller:"ProfileTopicsController"}).when("/profile/:profileId/posts",{templateUrl:"views/profile_posts.html",controller:"ProfilePostsController"}).otherwise({redirectTo:"/"})}]),a.config(["RestangularProvider",function(a){return a.setBaseUrl("/api/v1")}]),a.constant("Configs",{apiRoot:"/api/v1"}),a.run(["$rootScope","$location","$http","Configs","authService","UserSession",function(a,b,c,d,e,f){return a.changeView=function(a){return b.path(a)},a.logout=function(){return c.get(d.apiRoot+"/logout"),f.destroySession(),b.path("/login")},a.$on("event:auth-loginRequired",function(){return b.path("/login")}),a.$on("event:auth-loginConfirmed",function(a,c){return f.setSession(c),b.path("/")})}])}).call(this),function(){var a;a=angular.module("topicaApp"),a.controller("MainController",["Restangular","$scope","$http","Configs","$location","$rootScope","UserSession",function(a,b,c,d,e,f,g){return b.user=g.getSession(),b.baseUrl=d.apiRoot,a.all("home").getList().then(function(a){return b.posts=a}),a.one("users",b.user.id).all("topics").getList().then(function(a){var b;return f.topics=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push({id:b.id,text:b.name,selected:!1});return e}()})}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("LoginController",["Configs","$http","$scope","authService","UserSession",function(a,b,c,d,e){return c.credential={email:"",password:"",rememberMe:!1},c.submit=function(){return e.login(c.credential.email,c.credential.password,c.credential.rememberMe).then(function(a){var b;return b=a.data.user,d.loginConfirmed(b)},function(){return c.message="Invalid username or password."})}}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("SignupController",["Configs","$http","$scope","UserSession","authService",function(a,b,c,d,e){var f;return c.credential={},c.submittable=!1,f=!0,c.checkSubmittable=function(){return c.submittable=c.credential.email&&""!==c.credential.email&&c.credential.username&&""!==c.credential.username&&c.credential.password&&""!==c.credential.password&&c.credential.passwordConfirmation&&""!==c.credential.passwordConfirmaion,f=c.credential.password&&c.credential.passwordConfirmation!==c.credential.password?!1:!0,c.submittable&=f,c.message=f?"":"Password not match."},c.submit=function(){return b.post(a.apiRoot+"/signup",{email:c.credential.email,password:c.credential.password,password_confirmation:c.credential.passwordConfirmation,username:c.credential.username}).then(function(){return d.login(c.credential.email,c.credential.password).then(function(a){var b;return b=a.data.user,e.loginConfirmed(b)},function(){return c.message="Invalid username or password"})},function(a){return console.log(a),c.message=a.data.message})}}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("NavbarController",["$rootScope","UserSession","$scope",function(a,b,c){var d,e,f,g;return c.user=b.getSession(),f=!1,e=!1,g=!1,d=[{name:"user",text:"Users",icon:"user"},{name:"feed",text:"Feeds",icon:"folder"},{name:"topic",text:"Topics",icon:"comment-o"}],c.visibleItems=d,c.arrowClass=function(){return g?"fa-angle-double-left":"fa-angle-double-right"},c.selectMenuItem=function(a){return g?(c.visibleItems=d,g=!1):(c.visibleItems=[c.visibleItems[a]],g=!0)},c.toggleHotcornerMenu=function(){return e=!e},c.showMenuItem=function(a){return""===selectedMenuItem||selectedMenuItem===a},c.hotcornerIconClass=function(){return c.hoverHotcornerMenu||e?"hotcorner-selected":""},c.hotcornerMenuClass=function(){return e?"hotcorner-open-all":c.hoverHotcornerMenu?"hotcorner-open-all":c.hoverHotcornerIcon?"hotcorner-open-part":""}}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("NewPostController",["Restangular","$scope","Configs","UserSession","$http","$rootScope",function(a,b,c,d,e,f){return b.user=d.getSession(),b.baseUrl=c.apiRoot,b.newPost={},f.topics=[],a.one("users",b.user.id).all("topics").getList().then(function(a){var b;return f.topics=function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push({id:b.id,text:b.name,selected:!1});return e}()}),b.itemTemplate={topic_type:1},b.createNewPost=function(){return b.selectedTopicIds=_.map(_.filter(b.topics,"selected"),function(a){return a.id}),e.post(c.apiRoot+"/posts/",{title:b.newPost.title,content:b.newPost.content,topic_ids:b.selectedTopicIds}).then(function(a){var c;return b.newPost=a.data,b.newPost.user=b.user,b.newPost.num_of_comments=0,b.newPost.topics=_.map(_.filter(b.topics,"selected"),function(a){return{id:a.id,name:a.text,topic_type:a.topic_type}}),c=angular.element(document.getElementById("main-view")).scope(),console.log(c),c.posts.unshift(b.newPost),b.newPost={}}),b.edit=!1},b.addItem=function(a){return console.log(a)}}])}.call(this),function(){var a;a=angular.module("topicaApp.directives.pluspicker",[]),a.directive("pluspicker",["$document","$http",function(a,b){var c,d;return d=null,c=angular.noop,{restrict:"CA",scope:{items:"=",addItem:"&onAdd",remoteUrl:"@",itemTemplate:"&"},template:"<div ng-class=\"{'open': isOpen}\">\n  <div class='pluspicker-toggle pluspicker-box' ng-click=\"openMenu($event)\">\n    <span class='pluspicker-listitem' ng-repeat='item in selectedItems'>\n      <span class='pluspicker-listitem-content'>\n        <span class='pluspicker-listitem-text'>\n          {{item.text}}\n        </span>\n        <div class='pluspicker-close' ng-click='deselectItem({{item.id}}, $event)'>\n          <i class='fa fa-times-circle'></i>\n        </div>\n      </span>\n    </span>\n    <span class='pluspicker-input-area'>\n      <input type='text' class='pluspicker-input-area' placeholder='+ add topic' ng-model=\"input\">\n      </input>\n    </span>\n  </div>\n  <ul class='pluspicker-menu'>\n    <li class='pluspicker-menu-item' ng-repeat='item in items | filter: {selected: false} | filter: input' ng-click='selectItem({{item.id}}, $event)'>\n      <a>\n        {{item.text}}\n      </a>\n    </li>\n    <li class='pluspicker-menu-item pluspicker-menu-add' ng-click='newItem()' ng-show='!!input && isNew()'>\n      <a>\n        Add \"{{input}}\"\n      </a>\n    </li>\n  </ul>\n</div>",link:function(c){return c.selectedItems=[],c.isNew=function(){return!_.contains(_.map(c.items,function(a){return a.text}),c.input)},c.newItem=function(){var a;return a=c.itemTemplate(),a.name=c.input,b.post(c.remoteUrl,a).then(function(b){var d;return d={id:b.data.id,text:a.name,selected:!0},c.selectedItems.push(d),c.items.unshift(d)}),c.input="",c.addItem({item:c.input})},c.selectItem=function(a,b){var d;return d=_.find(c.items,function(b){return b.id===a}),d.selected=!0,c.selectedItems.push(d),b.preventDefault(),b.stopPropagation()},c.deselectItem=function(a,b){return _.find(c.items,function(b){return b.id===a}).selected=!1,c.selectedItems=c.selectedItems.filter(function(b){return b.id!==a}),b.preventDefault(),b.stopPropagation()},a.bind("click",function(){return c.$apply("isOpen = false"),c.$apply("input = ''")}),c.openMenu=function(a){return a.preventDefault(),a.stopPropagation(),c.isOpen=!0},c.$watch("$location.path",function(){return c.isOpen=!1,c.input=""})}}}])}.call(this),function(){var a;a=angular.module("topicaApp.directives.ngFocus",[]),a.directive("ngFocus",["$timeout",function(a){return{link:function(b,c,d){return b.$watch(d.ngFocus,function(b){return angular.isDefined(b)&&b?a(function(){return c[0].focus()}):void 0},!0),c.bind("blur",function(){return angular.isDefined(d.ngFocusLost)?b.$apply(d.ngFocusLost):void 0})}}}])}.call(this),function(){var a;a=angular.module("topicaApp.directives.newscard",[]),a.directive("newscard",["$http","Restangular",function(a,b){return{restrict:"CA",scope:{posts:"=",user:"=",topics:"="},templateUrl:"views/templates/newscard.html",link:function(a){var c,d,e;return a.newComment=[],c=[],d=[],e=[],a.toggleComments=function(d){return c[d]=!c[d],c[d]?b.one("posts",a.posts[d].id).getList("comments").then(function(b){return a.posts[d].comments=b,a.posts[d].comment_size!==b.length?a.posts[d].comment_size=b.length:void 0}):void 0},a.commentIsOpen=function(a){return!!c[a]},a.openNewComment=function(a){return d[a]=!0,e[a]=!1},a.closeNewComment=function(b){return d[b]=!1,a.posts[b].newComment=""},a.openRepostComment=function(a){return e[a]=!0,d[a]=!1},a.closeRepostComment=function(b){return e[b]=!1,a.posts[b].newComment=""},a.newCommentIsOpen=function(a){return!!d[a]},a.repostCommentIsOpen=function(a){return!!e[a]},a.submitComment=function(c){return b.one("posts",a.posts[c].id).all("comments").post({content:a.posts[c].newComment}).then(function(b){return a.posts[c].newComment="",b.user=a.user,a.posts[c].comments||(a.posts[c].comments=[]),a.posts[c].comments.push(b),a.posts[c].comment_size+=1})},a.commentLoseFocus=function(){return a.focusComment=!1},a.reposeCommentLoseFocus=function(){return a.focusRepostComment=!1}}}}])}.call(this),function(){var a;a=angular.module("topicaApp.filters.linebreak",[]),a.filter("linebreak",function(){return function(a){return a.replace(/\n/g,"<br/>")}})}.call(this),function(){var a;a=angular.module("topicaApp"),a.service("UserSession",["$http","Configs","authService","$cookies","$location",function(a,b,c,d,e){var f;return f=void 0,this.login=function(c,d,e){return a.post(b.apiRoot+"/login",{email:c,password:d,remember:e})},this.setSession=function(a){return f={},f.id=a.id,f.username=a.username,f.email=a.email,console.log(f.id),d.id=""+f.id,d.username=f.username,d.email=f.email},this.destroySession=function(){return f=void 0,delete d.uid,delete d.email,delete d.username},this.getSession=function(){return null!=f?f:null!=d.id?(f={},f.id=parseInt(d.id),f.username=d.username,f.email=d.email,f):(this.destroySession(),e.path("/login"),void 0)}}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.service("ProfileActivePage",function(){var a;return a="",this.setActivePage=function(b){return a=b},this.getActivePage=function(){return a}})}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("ProfileAboutController",["Restangular","$scope","$location","UserSession","$routeParams","ProfileActivePage",function(a,b,c,d,e,f){return b.user=d.getSession(),b.profileId=e.profileId,b.profileUser={id:e.profileId},a.one("users",b.profileUser.id).get().then(function(a){return b.profileUser.email=a.email,b.profileUser.username=a.username}),b.isActivePage=function(a){return f.getActivePage()===a},b.goto=function(a){var d;return f.setActivePage(a),d="profile/"+b.profileId+"/"+a,c.path(d)}}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("ProfileTopicsController",["Restangular","UserSession","$scope","Configs","$routeParams",function(a,b,c,d,e){return c.baseUrl=d.apiRoot,c.user=b.getSession(),c.profileId=e.profileId,a.one("users",c.profileId).all("detailed_topics").getList().then(function(a){return c.topics=a}),c.showPosts=function(b){return c.openningPostTopic=b===c.openningPostTopic?void 0:b,a.one("topics",b).all("posts").getList().then(function(a){return _.find(c.topics,function(a){return a.id===b}).posts=a})}}])}.call(this),function(){var a;a=angular.module("topicaApp"),a.controller("ProfilePostsController",["Restangular","UserSession","$scope","Configs","$routeParams",function(a,b,c,d,e){return c.baseUrl=d.apiRoot,c.user=b.getSession(),c.profileId=e.profileId,a.one("users",c.user.id).all("detailed_topics").getList().then(function(a){return c.topics=a}),c.showPosts=function(b){return c.openningPostTopic=b===c.openningPostTopic?void 0:b,a.one("topics",b).all("posts").getList().then(function(a){return _.find(c.topics,function(a){return a.id===b}).posts=a})}}])}.call(this);